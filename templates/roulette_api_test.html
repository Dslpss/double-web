<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste API Roleta Brasileira</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .button.danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }
        
        .button.warning {
            background: linear-gradient(45deg, #ff9800, #f57c00);
        }
        
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status.success { background: #4CAF50; }
        .status.error { background: #f44336; }
        .status.warning { background: #ff9800; }
        
        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stats-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .stats-number {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .roulette-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin: 2px;
            font-weight: bold;
            color: white;
        }
        
        .red { background: #dc3545; }
        .black { background: #343a40; }
        .green { background: #28a745; }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé∞ Teste API Roleta Brasileira</h1>
            <p>Teste da integra√ß√£o com a API da Pragmatic Play</p>
        </div>
        
        <!-- Se√ß√£o de Controles -->
        <div class="test-section">
            <h3>üîß Controles do Sistema</h3>
            <button class="button" onclick="testConnection()">üîç Testar Conex√£o</button>
            <button class="button" onclick="initIntegrator()">üöÄ Inicializar Integrador</button>
            <button class="button warning" onclick="fetchStatistics()">üìä Buscar Estat√≠sticas</button>
            <button class="button danger" onclick="clearResults()">üßπ Limpar Resultados</button>
        </div>
        
        <!-- Status da Conex√£o -->
        <div class="test-section">
            <h3>üì° Status da Conex√£o</h3>
            <div id="connection-status">
                <p>Clique em "Testar Conex√£o" para verificar o status</p>
            </div>
        </div>
        
        <!-- Estat√≠sticas -->
        <div class="test-section">
            <h3>üìà Estat√≠sticas</h3>
            <div class="grid">
                <div class="stats-card">
                    <div>Total de Resultados</div>
                    <div class="stats-number" id="total-results">0</div>
                </div>
                <div class="stats-card">
                    <div>Vermelho</div>
                    <div class="stats-number" id="red-count">0</div>
                </div>
                <div class="stats-card">
                    <div>Preto</div>
                    <div class="stats-number" id="black-count">0</div>
                </div>
                <div class="stats-card">
                    <div>Verde (0)</div>
                    <div class="stats-number" id="green-count">0</div>
                </div>
            </div>
        </div>
        
        <!-- √öltimos Resultados -->
        <div class="test-section">
            <h3>üéØ √öltimos 20 Resultados</h3>
            <div id="recent-results">
                <p>Nenhum resultado ainda. Busque as estat√≠sticas para ver os dados.</p>
            </div>
        </div>
        
        <!-- N√∫meros Mais Frequentes -->
        <div class="test-section">
            <h3>üî• Top 10 N√∫meros Mais Frequentes</h3>
            <div id="hot-numbers">
                <p>Busque as estat√≠sticas para ver os n√∫meros mais frequentes.</p>
            </div>
        </div>
        
        <!-- Log de Debug -->
        <div class="test-section">
            <h3>üêõ Log de Debug</h3>
            <div class="code-block" id="debug-log">
                Sistema iniciado. Aguardando comandos...
            </div>
        </div>
    </div>

    <script>
        let debugLog = document.getElementById('debug-log');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.textContent += `\n[${timestamp}] ${message}`;
            debugLog.scrollTop = debugLog.scrollHeight;
        }
        
        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Carregando...</p>
                </div>
            `;
        }
        
        async function testConnection() {
            log('üîç Testando conex√£o...');
            showLoading('connection-status');
            
            try {
                const response = await fetch('/api/roulette/test_connection');
                const data = await response.json();
                
                log(`‚úÖ Teste de conex√£o conclu√≠do: ${data.success ? 'SUCESSO' : 'FALHA'}`);
                
                let statusHtml = '<h4>Diagn√≥sticos:</h4>';
                
                // Status do integrador
                const integrator = data.diagnostics.roulette_integrator;
                statusHtml += `<p><strong>Integrador Principal:</strong> 
                    ${integrator.available ? '‚úÖ Dispon√≠vel' : '‚ùå N√£o dispon√≠vel'}
                    ${integrator.has_jsessionid ? '<span class="status success">JSESSIONID OK</span>' : '<span class="status error">SEM JSESSIONID</span>'}
                </p>`;
                
                if (integrator.jsessionid_preview) {
                    statusHtml += `<p><small>JSESSIONID: ${integrator.jsessionid_preview}</small></p>`;
                }
                
                // Status do cliente de estat√≠sticas
                const stats = data.diagnostics.statistics_client;
                statusHtml += `<p><strong>Cliente de Estat√≠sticas:</strong> 
                    ${stats.available ? '‚úÖ Dispon√≠vel' : '‚ùå N√£o dispon√≠vel'}
                    ${stats.initialized ? '<span class="status success">Inicializado</span>' : '<span class="status warning">N√£o inicializado</span>'}
                </p>`;
                
                // Teste da API
                if (data.diagnostics.api_test) {
                    const apiTest = data.diagnostics.api_test;
                    statusHtml += `<p><strong>Teste da API:</strong> 
                        ${apiTest.success ? '‚úÖ Sucesso' : '‚ùå Falha'}
                        <span class="status ${apiTest.success ? 'success' : 'error'}">${apiTest.message}</span>
                    </p>`;
                }
                
                if (data.diagnostics.init_error) {
                    statusHtml += `<p><strong>Erro de Inicializa√ß√£o:</strong> <span class="status error">${data.diagnostics.init_error}</span></p>`;
                }
                
                document.getElementById('connection-status').innerHTML = statusHtml;
                
            } catch (error) {
                log(`‚ùå Erro no teste de conex√£o: ${error.message}`);
                document.getElementById('connection-status').innerHTML = `
                    <p><span class="status error">ERRO</span> ${error.message}</p>
                `;
            }
        }
        
        async function initIntegrator() {
            log('üöÄ Inicializando integrador...');
            
            try {
                const response = await fetch('/api/roulette/start', {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    log('‚úÖ Integrador inicializado com sucesso');
                } else {
                    log(`‚ùå Erro ao inicializar: ${data.error}`);
                }
                
                // Atualizar status ap√≥s inicializa√ß√£o
                setTimeout(testConnection, 1000);
                
            } catch (error) {
                log(`‚ùå Erro ao inicializar integrador: ${error.message}`);
            }
        }
        
        async function fetchStatistics() {
            log('üìä Buscando estat√≠sticas...');
            showLoading('recent-results');
            showLoading('hot-numbers');
            
            try {
                const response = await fetch('/api/roulette/statistics/enhanced?games=100');
                const data = await response.json();
                
                if (data.success) {
                    log(`‚úÖ Estat√≠sticas obtidas: ${data.total} resultados (${data.is_real_data ? 'dados reais' : 'dados simulados'})`);
                    
                    // Atualizar contadores
                    updateStatistics(data.statistics);
                    
                    // Mostrar √∫ltimos resultados
                    displayRecentResults(data.results.slice(0, 20));
                    
                    // Mostrar n√∫meros mais frequentes
                    displayHotNumbers(data.statistics.top_numbers);
                    
                } else {
                    log(`‚ùå Erro ao buscar estat√≠sticas: ${data.error}`);
                    document.getElementById('recent-results').innerHTML = `<p>Erro: ${data.error}</p>`;
                    document.getElementById('hot-numbers').innerHTML = `<p>Erro: ${data.error}</p>`;
                }
                
            } catch (error) {
                log(`‚ùå Erro na requisi√ß√£o: ${error.message}`);
                document.getElementById('recent-results').innerHTML = `<p>Erro: ${error.message}</p>`;
                document.getElementById('hot-numbers').innerHTML = `<p>Erro: ${error.message}</p>`;
            }
        }
        
        function updateStatistics(stats) {
            document.getElementById('total-results').textContent = stats.total_games;
            document.getElementById('red-count').textContent = stats.colors.red;
            document.getElementById('black-count').textContent = stats.colors.black;
            document.getElementById('green-count').textContent = stats.colors.green;
        }
        
        function displayRecentResults(results) {
            let html = '<div>';
            
            results.forEach(result => {
                const colorClass = result.color;
                html += `<span class="roulette-number ${colorClass}">${result.number}</span>`;
            });
            
            html += '</div>';
            html += `<p><small>√öltimos ${results.length} resultados (mais recente √† esquerda)</small></p>`;
            
            document.getElementById('recent-results').innerHTML = html;
        }
        
        function displayHotNumbers(topNumbers) {
            let html = '<div>';
            
            topNumbers.forEach((item, index) => {
                const number = parseInt(item[0]);
                const count = item[1];
                
                let colorClass;
                if (number === 0) {
                    colorClass = 'green';
                } else if ([1, 3, 5, 7, 9, 12, 14, 16, 18, 19, 21, 23, 25, 27, 30, 32, 34, 36].includes(number)) {
                    colorClass = 'red';
                } else {
                    colorClass = 'black';
                }
                
                html += `
                    <div style="display: inline-block; margin: 10px; text-align: center;">
                        <span class="roulette-number ${colorClass}">${number}</span>
                        <div style="font-size: 12px; margin-top: 5px;">${count}x</div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            document.getElementById('hot-numbers').innerHTML = html;
        }
        
        function clearResults() {
            log('üßπ Limpando resultados...');
            
            document.getElementById('total-results').textContent = '0';
            document.getElementById('red-count').textContent = '0';
            document.getElementById('black-count').textContent = '0';
            document.getElementById('green-count').textContent = '0';
            document.getElementById('recent-results').innerHTML = '<p>Resultados limpos.</p>';
            document.getElementById('hot-numbers').innerHTML = '<p>N√∫meros limpos.</p>';
            
            log('‚úÖ Resultados limpos');
        }
        
        // Inicializa√ß√£o
        window.addEventListener('load', function() {
            log('üé∞ Sistema de teste da API da Roleta Brasileira carregado');
            log('üí° Dica: Comece testando a conex√£o, depois inicialize o integrador');
        });
        
        // Auto-refresh a cada 30 segundos (opcional)
        setInterval(function() {
            if (document.getElementById('total-results').textContent !== '0') {
                log('üîÑ Atualizando estat√≠sticas automaticamente...');
                fetchStatistics();
            }
        }, 30000);
    </script>
</body>
</html>