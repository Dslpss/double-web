<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Padr√µes Personalizados - Double Analyzer</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      .pattern-card {
        transition: transform 0.2s;
        border-left: 4px solid #007bff;
      }
      .pattern-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .pattern-card.enabled {
        border-left-color: #28a745;
      }
      .pattern-card.disabled {
        border-left-color: #dc3545;
        opacity: 0.7;
      }
      .trigger-badge {
        font-size: 0.8em;
      }
      .stats-badge {
        font-size: 0.75em;
      }
      .modal-lg {
        max-width: 800px;
      }
      .form-section {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        border-left: 4px solid #007bff;
      }
      .form-section h6 {
        color: #495057;
        margin-bottom: 15px;
        font-weight: 600;
      }
      .config-preview {
        background-color: #fff;
        border: 2px dashed #dee2e6;
        border-radius: 8px;
        padding: 20px;
        font-family: monospace;
        font-size: 0.9em;
        min-height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .action-buttons {
        gap: 5px;
      }
      .pattern-type-icon {
        width: 20px;
        height: 20px;
        display: inline-block;
        margin-right: 8px;
      }
      .success-rate {
        font-weight: bold;
      }
      .success-rate.high {
        color: #28a745;
      }
      .success-rate.medium {
        color: #ffc107;
      }
      .success-rate.low {
        color: #dc3545;
      }
      .alert {
        border-left: 4px solid;
        border-radius: 8px;
        margin-bottom: 15px;
      }
      .alert-info {
        border-left-color: #17a2b8;
        background-color: #d1ecf1;
        color: #0c5460;
      }
      .alert-success {
        border-left-color: #28a745;
        background-color: #d4edda;
        color: #155724;
      }
      .alert-warning {
        border-left-color: #ffc107;
        background-color: #fff3cd;
        color: #856404;
      }
      .alert-light {
        border-left-color: #6c757d;
        background-color: #fefefe;
        color: #495057;
      }
      .form-range::-webkit-slider-thumb {
        background: #007bff;
      }
      .form-range::-moz-range-thumb {
        background: #007bff;
        border: none;
      }
      #confidenceValue {
        font-size: 0.875rem;
        padding: 0.25rem 0.5rem;
      }
      .tooltip-icon {
        cursor: help;
        color: #6c757d;
      }
      .tooltip-icon:hover {
        color: #007bff;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="/">
          <i class="fas fa-dice"></i> Double Analyzer
        </a>
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="/"><i class="fas fa-home"></i> Home</a>
          <a class="nav-link" href="/double"
            ><i class="fas fa-chart-line"></i> Double</a
          >
          <a class="nav-link active" href="#"
            ><i class="fas fa-cogs"></i> Padr√µes Personalizados</a
          >
        </div>
      </div>
    </nav>

    <div class="container mt-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col">
          <h2><i class="fas fa-cogs"></i> Padr√µes Personalizados</h2>
          <p class="text-muted">
            Crie e gerencie seus pr√≥prios padr√µes de detec√ß√£o para o Double
          </p>
        </div>
        <div class="col-auto">
          <button
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#createPatternModal"
          >
            <i class="fas fa-plus"></i> Novo Padr√£o
          </button>
          <button class="btn btn-outline-secondary" onclick="exportPatterns()">
            <i class="fas fa-download"></i> Exportar
          </button>
          <button
            class="btn btn-outline-secondary"
            onclick="document.getElementById('importFile').click()"
          >
            <i class="fas fa-upload"></i> Importar
          </button>
          <input
            type="file"
            id="importFile"
            accept=".json"
            style="display: none"
            onchange="importPatterns(this)"
          />
        </div>
      </div>

      <!-- Alert Type Control Panel -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-6">
                  <h6 class="card-title mb-1">
                    <i class="fas fa-bell"></i> Configura√ß√£o de Alertas
                  </h6>
                  <small class="text-muted">Escolha que tipo de alertas voc√™ deseja receber</small>
                </div>
                <div class="col-md-6">
                  <div class="d-flex gap-3 justify-content-md-end">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="enableSystemAlerts" checked>
                      <label class="form-check-label" for="enableSystemAlerts">
                        <i class="fas fa-robot text-primary"></i> Alertas do Sistema
                      </label>
                    </div>
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="enableCustomAlerts" checked>
                      <label class="form-check-label" for="enableCustomAlerts">
                        <i class="fas fa-user-cog text-success"></i> Padr√µes Customizados
                      </label>
                    </div>
                    <button class="btn btn-sm btn-outline-primary" onclick="testAlerts()" title="Testar alertas">
                      <i class="fas fa-vial"></i> Testar
                    </button>
                  </div>
                </div>
              </div>
              <div class="row mt-3" id="alertStatusDisplay">
                <div class="col-12">
                  <div class="alert alert-info d-flex align-items-center" role="alert">
                    <i class="fas fa-info-circle me-2"></i>
                    <span id="alertStatusText">Ambos os tipos de alertas est√£o ativos</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
          >
            <i class="fas fa-upload"></i> Importar
          </button>
          <input
            type="file"
            id="importFile"
            accept=".json"
            style="display: none"
            onchange="importPatterns(this)"
          />
        </div>
      </div>

      <!-- Status Cards -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card bg-primary text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title">Total de Padr√µes</h6>
                  <h3 id="totalPatterns">0</h3>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-cogs fa-2x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-success text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title">Padr√µes Ativos</h6>
                  <h3 id="activePatterns">0</h3>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-check-circle fa-2x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-warning text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title">Taxa de Sucesso</h6>
                  <h3 id="successRate">0%</h3>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-chart-line fa-2x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-info text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h6 class="card-title">Total de Triggers</h6>
                  <h3 id="totalTriggers">0</h3>
                </div>
                <div class="align-self-center">
                  <i class="fas fa-bolt fa-2x"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Patterns List -->
      <div class="row" id="patternsList">
        <!-- Patterns will be loaded here -->
      </div>

      <!-- Loading -->
      <div id="loading" class="text-center mt-4" style="display: none">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Carregando...</span>
        </div>
        <p class="mt-2">Carregando padr√µes...</p>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="text-center mt-5" style="display: none">
        <i class="fas fa-cogs fa-3x text-muted mb-3"></i>
        <h4 class="text-muted">Nenhum padr√£o personalizado encontrado</h4>
        <p class="text-muted">
          Crie seu primeiro padr√£o personalizado para come√ßar a detectar padr√µes
          espec√≠ficos.
        </p>
        <button
          class="btn btn-primary"
          data-bs-toggle="modal"
          data-bs-target="#createPatternModal"
        >
          <i class="fas fa-plus"></i> Criar Primeiro Padr√£o
        </button>
      </div>
    </div>

    <!-- Create/Edit Pattern Modal -->
    <div class="modal fade" id="createPatternModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">Criar Novo Padr√£o</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <!-- Se√ß√£o de Ajuda e Orienta√ß√µes -->
            <div class="alert alert-primary alert-dismissible fade show" role="alert">
              <div class="d-flex">
                <i class="fas fa-lightbulb me-2 mt-1"></i>
                <div class="flex-grow-1">
                  <strong>üí° Como funcionam os Padr√µes Personalizados:</strong>
                  <p class="mb-2">Configure <strong>gatilhos</strong> (quando detectar) e <strong>a√ß√µes</strong> (o que fazer) para automatizar sua estrat√©gia.</p>
                  <button class="btn btn-sm btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#quickHelp">
                    <i class="fas fa-question-circle"></i> Ver Guia R√°pido
                  </button>
                </div>
              </div>
              
              <div class="collapse mt-3" id="quickHelp">
                <div class="row small">
                  <div class="col-md-6">
                    <div class="border-start border-success border-3 ps-3 mb-3">
                      <h6 class="text-success mb-2">
                        <i class="fas fa-play-circle"></i> Gatilhos Populares
                      </h6>
                      <ul class="list-unstyled mb-0">
                        <li><span class="badge bg-info me-1">üéØ</span> <strong>Cor ap√≥s cor:</strong> Ex: "Red ap√≥s Black"</li>
                        <li><span class="badge bg-info me-1">üìä</span> <strong>N√∫mero + cor:</strong> Ex: "7 seguido de Red"</li>
                        <li><span class="badge bg-info me-1">‚è∞</span> <strong>Delay:</strong> Ex: "N√∫mero 5 n√£o sai h√° 8 rodadas"</li>
                      </ul>
                    </div>
                  </div>
                  
                  <div class="col-md-6">
                    <div class="border-start border-warning border-3 ps-3 mb-3">
                      <h6 class="text-warning mb-2">
                        <i class="fas fa-cogs"></i> A√ß√µes Recomendadas
                      </h6>
                      <ul class="list-unstyled mb-0">
                        <li><span class="badge bg-success me-1">üé≤</span> <strong>Apostar cor:</strong> Red, Black ou White</li>
                        <li><span class="badge bg-success me-1">üéØ</span> <strong>Apostar n√∫mero:</strong> Espec√≠fico (0-14)</li>
                        <li><span class="badge bg-success me-1">‚è∏Ô∏è</span> <strong>Aguardar:</strong> Pular esta rodada</li>
                      </ul>
                    </div>
                  </div>
                </div>
                
                <div class="bg-light p-2 rounded mt-2">
                  <small class="text-muted">
                    <i class="fas fa-info-circle"></i>
                    <strong>Dica de Confian√ßa:</strong> Use 60-80% para padr√µes equilibrados. Muito alto = poucas oportunidades, muito baixo = muitos alertas.
                  </small>
                </div>
              </div>
            </div>

            <form id="patternForm">
              <input type="hidden" id="patternId" />

              <!-- Basic Info -->
              <div class="form-section">
                <h6><i class="fas fa-info-circle"></i> Informa√ß√µes B√°sicas</h6>
                <div class="row">
                  <div class="col-md-6">
                    <label for="patternName" class="form-label"
                      >Nome do Padr√£o *</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="patternName"
                      required
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="patternEnabled" class="form-label"
                      >Status</label
                    >
                    <select class="form-select" id="patternEnabled">
                      <option value="true">Ativo</option>
                      <option value="false">Inativo</option>
                    </select>
                  </div>
                </div>
                <div class="row mt-3">
                  <div class="col-12">
                    <label for="patternDescription" class="form-label"
                      >Descri√ß√£o</label
                    >
                    <textarea
                      class="form-control"
                      id="patternDescription"
                      rows="2"
                    ></textarea>
                  </div>
                </div>
              </div>

              <!-- Trigger Configuration -->
              <div class="form-section">
                <h6><i class="fas fa-bolt text-primary"></i> Configura√ß√£o do Gatilho</h6>
                <div class="alert alert-info">
                  <i class="fas fa-info-circle"></i>
                  <strong>Gatilhos</strong> definem <em>quando</em> o padr√£o ser√° ativado. Escolha o tipo que melhor se adapta √† sua estrat√©gia de an√°lise.
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <label for="triggerType" class="form-label"
                      >Tipo de Gatilho *
                      <i class="fas fa-question-circle text-info" 
                         data-bs-toggle="tooltip" 
                         title="Selecione quando voc√™ quer que o sistema detecte e alerte sobre padr√µes"></i>
                    </label>
                    <select
                      class="form-select"
                      id="triggerType"
                      required
                      onchange="updateTriggerConfig()"
                    >
                      <option value="">Selecione um tipo</option>
                      <option value="number_followed_by_color" 
                              data-description="Detecta quando um n√∫mero espec√≠fico √© seguido por uma cor espec√≠fica"
                              data-example="Ex: N√∫mero 5 seguido pela cor VERMELHA">
                        üìä N√∫mero Seguido por Cor
                      </option>
                      <option value="color_sequence" 
                              data-description="Detecta sequ√™ncias espec√≠ficas de 2 cores consecutivas"
                              data-example="Ex: VERMELHO ‚Üí PRETO ‚Üí VERMELHO">
                        üåà Sequ√™ncia de Cores
                      </option>
                      <option value="color_after_color" 
                              data-description="Detecta quando uma cor espec√≠fica aparece ap√≥s outra cor"
                              data-example="Ex: VERMELHO sempre que vier ap√≥s PRETO">
                        üéØ Cor Ap√≥s Cor
                      </option>
                      <option value="specific_number_red" 
                              data-description="Monitora n√∫meros vermelhos espec√≠ficos (1,3,5,7,9,12,14)"
                              data-example="Ex: Quando sair o n√∫mero 7 (vermelho)">
                        üî¥ N√∫mero Vermelho Espec√≠fico
                      </option>
                      <option value="specific_number_black" 
                              data-description="Monitora n√∫meros pretos espec√≠ficos (2,4,6,8,10,11,13)"
                              data-example="Ex: Quando sair o n√∫mero 8 (preto)">
                        ‚ö´ N√∫mero Preto Espec√≠fico
                      </option>
                      <option value="specific_number_white" 
                              data-description="Monitora quando sai o n√∫mero 0 (branco)"
                              data-example="Ex: Quando sair o 0 (branco)">
                        ‚ö™ N√∫mero Branco (0)
                      </option>
                      <option value="red_after_black" 
                              data-description="Detecta quando VERMELHO aparece logo ap√≥s PRETO"
                              data-example="Ex: PRETO ‚Üí VERMELHO">
                        üî¥‚ö´ Vermelho Ap√≥s Preto
                      </option>
                      <option value="black_after_red" 
                              data-description="Detecta quando PRETO aparece logo ap√≥s VERMELHO"
                              data-example="Ex: VERMELHO ‚Üí PRETO">
                        ‚ö´üî¥ Preto Ap√≥s Vermelho
                      </option>
                      <option value="white_after_any" 
                              data-description="Detecta quando BRANCO (0) aparece ap√≥s qualquer cor"
                              data-example="Ex: Qualquer cor ‚Üí BRANCO (0)">
                        ‚ö™ Branco Ap√≥s Qualquer
                      </option>
                      <option value="number_delay_alert" 
                              data-description="Alerta quando um n√∫mero n√£o sai h√° X resultados"
                              data-example="Ex: N√∫mero 5 n√£o sai h√° 10 rodadas">
                        ‚è∞ Delay de N√∫mero (Alerta)
                      </option>
                    </select>
                    <div class="mt-2">
                      <small id="triggerTypeHelp" class="text-muted">
                        <i class="fas fa-arrow-up"></i> Selecione um tipo para ver a explica√ß√£o e exemplo
                      </small>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="minOccurrences" class="form-label"
                      >Ocorr√™ncias M√≠nimas
                      <i class="fas fa-question-circle text-info" 
                         data-bs-toggle="tooltip" 
                         title="Quantas vezes o padr√£o deve ocorrer consecutivamente antes de ativar o alerta"></i>
                    </label>
                    <input
                      type="number"
                      class="form-control"
                      id="minOccurrences"
                      min="1"
                      max="10"
                      value="1"
                    />
                    <small class="text-muted">
                      <i class="fas fa-lightbulb text-warning"></i> 
                      <strong>Recomendado:</strong> 1-3 para iniciantes, 3-5 para conservadores
                    </small>
                  </div>
                </div>
                <div id="triggerConfigArea" class="mt-3" style="display: none">
                  <!-- Dynamic trigger config will be inserted here -->
                </div>
              </div>

              <!-- Action Configuration -->
              <div class="form-section">
                <h6><i class="fas fa-play text-success"></i> Configura√ß√£o da A√ß√£o</h6>
                <div class="alert alert-success">
                  <i class="fas fa-target"></i>
                  <strong>A√ß√µes</strong> definem <em>o que fazer</em> quando o gatilho for detectado. Configure a recomenda√ß√£o que ser√° mostrada.
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <label for="actionType" class="form-label"
                      >Tipo de A√ß√£o *
                      <i class="fas fa-question-circle text-info" 
                         data-bs-toggle="tooltip" 
                         title="Escolha que tipo de recomenda√ß√£o ser√° mostrada quando o padr√£o for detectado"></i>
                    </label>
                    <select
                      class="form-select"
                      id="actionType"
                      required
                      onchange="updateActionConfig()"
                    >
                      <option value="">Selecione uma a√ß√£o</option>
                      <option value="bet_color" 
                              data-description="Recomenda apostar em uma cor espec√≠fica"
                              data-example="Ex: 'Aposte no VERMELHO' ou 'Aposte no PRETO'">
                        üé® Apostar em Cor
                      </option>
                      <option value="bet_number" 
                              data-description="Recomenda apostar em um n√∫mero espec√≠fico"
                              data-example="Ex: 'Aposte no n√∫mero 7' ou 'Aposte no n√∫mero 0'">
                        üéØ Apostar em N√∫mero
                      </option>
                      <option value="skip_bet" 
                              data-description="Recomenda n√£o apostar nesta rodada"
                              data-example="Ex: 'Pule esta rodada - aguarde melhor oportunidade'">
                        ‚è∏Ô∏è Pular Aposta
                      </option>
                      <option value="wait" 
                              data-description="Recomenda aguardar e observar mais resultados"
                              data-example="Ex: 'Aguarde - padr√£o ainda se formando'">
                        ‚è≥ Aguardar
                      </option>
                    </select>
                    <div class="mt-2">
                      <small id="actionTypeHelp" class="text-muted">
                        <i class="fas fa-arrow-up"></i> Selecione uma a√ß√£o para ver a explica√ß√£o e exemplo
                      </small>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="confidenceThreshold" class="form-label"
                      >N√≠vel de Confian√ßa 
                      <i class="fas fa-question-circle text-info" 
                         data-bs-toggle="tooltip" 
                         title="Porcentagem m√≠nima de certeza para ativar o alerta. Recomendado: 60-80%"></i>
                      (<span id="confidenceValue">70%</span>)</label
                    >
                    <input
                      type="range"
                      class="form-range"
                      id="confidenceThreshold"
                      min="0.1"
                      max="1"
                      step="0.05"
                      value="0.7"
                      oninput="updateConfidenceValue()"
                    />
                    <div class="d-flex justify-content-between small text-muted">
                      <span>10% (Muito sens√≠vel)</span>
                      <span>100% (Muito r√≠gido)</span>
                    </div>
                    <small class="text-muted">
                      <i class="fas fa-balance-scale text-info"></i> 
                      <strong>Sugest√£o:</strong> 60-70% para iniciantes, 75-85% para conservadores
                    </small>
                  </div>
                </div>
                <div id="actionConfigArea" class="mt-3">
                  <!-- Dynamic action config will be inserted here -->
                </div>
              </div>
                  <strong>A√ß√µes</strong> definem o que fazer quando o padr√£o for detectado. Esta √© a sua estrat√©gia de aposta.
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <label for="actionType" class="form-label"
                      >Tipo de A√ß√£o *</label
                    >
                    <select
                      class="form-select"
                      id="actionType"
                      required
                      onchange="updateActionConfig()"
                    >
                      <option value="">Selecione uma a√ß√£o</option>
                      <option value="bet_color" title="Apostar em uma cor espec√≠fica (RED/BLACK/WHITE)">
                        üé® Apostar na Cor
                      </option>
                      <option value="bet_number" title="Apostar em um n√∫mero espec√≠fico (0-14)">
                        üî¢ Apostar no N√∫mero
                      </option>
                      <option value="bet_sector" title="Apostar em um setor (baixo/m√©dio/alto)">
                        üìä Apostar no Setor
                      </option>
                      <option value="skip_bet" title="N√£o apostar nesta rodada">
                        ‚è≠Ô∏è Pular Aposta
                      </option>
                      <option value="wait" title="Aguardar pr√≥xima oportunidade">
                        ‚è≥ Aguardar
                      </option>
                    </select>
                    <small class="text-muted mt-1">
                      <span id="actionTypeHelp">Selecione uma a√ß√£o para ver a explica√ß√£o</span>
                    </small>
                  </div>
                  <div class="col-md-6">
                    <label for="actionConfig" class="form-label"
                      >Configura√ß√£o da A√ß√£o</label
                    >
                    <div id="actionConfigArea">
                      <!-- Dynamic action config will be inserted here -->
                    </div>
                  </div>
                </div>
              </div>

              <!-- Advanced Settings -->
              <div class="form-section">
                <h6><i class="fas fa-cog"></i> Configura√ß√µes Avan√ßadas</h6>
                <div class="alert alert-warning">
                  <i class="fas fa-exclamation-triangle"></i>
                  <strong>Configura√ß√µes Avan√ßadas</strong> - Ajuste estes valores com cuidado. Valores muito baixos podem gerar muitos alertas falsos.
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <label for="confidenceThreshold" class="form-label">
                      Limiar de Confian√ßa
                      <i class="fas fa-question-circle" title="Qu√£o confiante o sistema deve estar antes de alertar"></i>
                    </label>
                    <input
                      type="range"
                      class="form-range"
                      id="confidenceThreshold"
                      min="0.5"
                      max="1"
                      step="0.05"
                      value="0.7"
                      oninput="updateConfidenceValue()"
                    />
                    <div class="d-flex justify-content-between">
                      <small>50% (Menos rigoroso)</small>
                      <span id="confidenceValue" class="badge bg-primary">70%</span>
                      <small>100% (Muito rigoroso)</small>
                    </div>
                    <small class="text-muted">Recomendado: 60-80% para a maioria dos casos</small>
                  </div>
                  <div class="col-md-6">
                    <label for="cooldownMinutes" class="form-label">
                      Cooldown (minutos)
                      <i class="fas fa-question-circle" title="Tempo de espera entre alertas do mesmo padr√£o"></i>
                    </label>
                    <input
                      type="number"
                      class="form-control"
                      id="cooldownMinutes"
                      min="1"
                      max="60"
                      value="5"
                    />
                    <small class="text-muted">Evita spam de alertas. Recomendado: 3-10 minutos</small>
                  </div>
                </div>
              </div>

              <!-- Examples & Tips -->
              <div class="form-section">
                <h6><i class="fas fa-lightbulb"></i> Exemplos & Dicas</h6>
                <div id="patternExamples" class="row">
                  <div class="col-12">
                    <div class="alert alert-light">
                      <h6><i class="fas fa-graduation-cap"></i> Dicas para Iniciantes:</h6>
                      <ul class="mb-0">
                        <li><strong>Padr√£o Simples:</strong> "Cor Ap√≥s Cor" - Ex: RED ap√≥s BLACK com confian√ßa 70%</li>
                        <li><strong>Padr√£o Num√©rico:</strong> "N√∫mero Seguido por Cor" - Ex: N√∫mero 1 seguido por RED</li>
                        <li><strong>Padr√£o de Delay:</strong> "Delay de N√∫mero" - Ex: Alertar quando n√∫mero 5 n√£o sai h√° 10 rodadas</li>
                        <li><strong>Configura√ß√£o Inicial:</strong> Use confian√ßa entre 60-70% e cooldown de 5 minutos</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Preview -->
              <div class="form-section">
                <h6><i class="fas fa-eye"></i> Pr√©-visualiza√ß√£o do Padr√£o</h6>
                <div class="config-preview" id="configPreview">
                  <div class="text-center text-muted">
                    <i class="fas fa-info-circle fa-2x mb-2"></i>
                    <p>Selecione um tipo de gatilho e a√ß√£o para ver a pr√©-visualiza√ß√£o do seu padr√£o</p>
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="savePattern()"
            >
              <i class="fas fa-save"></i> Salvar Padr√£o
            </button>
          </div>
        </div>
      </div>

      <!-- Pattern Stats Modal -->
      <div class="modal fade" id="statsModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Estat√≠sticas do Padr√£o</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
              ></button>
            </div>
            <div class="modal-body" id="statsContent">
              <!-- Stats will be loaded here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let patterns = [];
      let editingPattern = null;

      // Configura√ß√µes de alertas
      let alertSettings = {
        systemAlerts: true,
        customAlerts: true
      };

      // Load patterns on page load
      document.addEventListener("DOMContentLoaded", function () {
        loadPatterns();
        initializeAlertControls();
      });

      // Inicializar controles de alerta
      function initializeAlertControls() {
        const systemToggle = document.getElementById('enableSystemAlerts');
        const customToggle = document.getElementById('enableCustomAlerts');
        
        // Carregar configura√ß√µes do servidor
        loadAlertSettingsFromServer();

        // Event listeners para os toggles
        systemToggle.addEventListener('change', function() {
          alertSettings.systemAlerts = this.checked;
          updateAlertSettings();
        });

        customToggle.addEventListener('change', function() {
          alertSettings.customAlerts = this.checked;
          updateAlertSettings();
        });
      }

      // Carregar configura√ß√µes do servidor
      async function loadAlertSettingsFromServer() {
        try {
          console.log('Carregando configura√ß√µes de alerta...');
          
          // Primeiro, verificar se h√° configura√ß√µes no localStorage
          const localSettings = localStorage.getItem('alertSettings');
          let hasLocalSettings = false;
          
          if (localSettings) {
            try {
              const parsedLocal = JSON.parse(localSettings);
              alertSettings = parsedLocal;
              hasLocalSettings = true;
              console.log('Configura√ß√µes locais encontradas:', alertSettings);
            } catch (e) {
              console.warn('Erro ao parsear configura√ß√µes locais:', e);
            }
          }
          
          // Se temos configura√ß√µes locais, usar elas e sincronizar com servidor
          if (hasLocalSettings) {
            console.log('Usando configura√ß√µes locais e sincronizando com servidor...');
            await saveAlertSettingsToBackend();
          } else {
            // Se n√£o h√° configura√ß√µes locais, buscar do servidor
            console.log('Buscando configura√ß√µes do servidor...');
            const response = await fetch('/api/alert-settings');
            if (response.ok) {
              const data = await response.json();
              if (data.success) {
                alertSettings = data.settings;
                console.log('Configura√ß√µes do servidor carregadas:', alertSettings);
                // Salvar no localStorage para pr√≥xima vez
                localStorage.setItem('alertSettings', JSON.stringify(alertSettings));
              }
            }
          }
          
          // Atualizar UI
          document.getElementById('enableSystemAlerts').checked = alertSettings.systemAlerts;
          document.getElementById('enableCustomAlerts').checked = alertSettings.customAlerts;
          
          updateAlertStatus();
          console.log('UI atualizada com configura√ß√µes:', alertSettings);
          
        } catch (error) {
          console.error('Erro ao carregar configura√ß√µes:', error);
          // Em caso de erro, usar configura√ß√µes padr√£o
          alertSettings = { systemAlerts: true, customAlerts: true };
          updateAlertStatus();
        }
      }

      // Atualizar configura√ß√µes de alerta
      function updateAlertSettings() {
        console.log('Atualizando configura√ß√µes:', alertSettings);
        
        // Salvar no localStorage IMEDIATAMENTE
        try {
          localStorage.setItem('alertSettings', JSON.stringify(alertSettings));
          console.log('‚úÖ Configura√ß√µes salvas no localStorage');
        } catch (error) {
          console.error('‚ùå Erro ao salvar no localStorage:', error);
        }
        
        // Atualizar status visual
        updateAlertStatus();
        
        // Enviar para o backend (async, n√£o bloqueia)
        saveAlertSettingsToBackend().then(() => {
          console.log('Sincroniza√ß√£o com servidor conclu√≠da');
        }).catch(error => {
          console.error('Erro na sincroniza√ß√£o:', error);
        });
        
        // Mostrar notifica√ß√£o de sucesso
        showAlertSettingsNotification();
      }

      // Atualizar status visual dos alertas
      function updateAlertStatus() {
        const statusText = document.getElementById('alertStatusText');
        const statusDisplay = document.getElementById('alertStatusDisplay').querySelector('.alert');
        
        if (alertSettings.systemAlerts && alertSettings.customAlerts) {
          statusText.innerHTML = '<i class="fas fa-check-double text-success"></i> Ambos os tipos de alertas est√£o ativos';
          statusDisplay.className = 'alert alert-success d-flex align-items-center';
        } else if (alertSettings.systemAlerts && !alertSettings.customAlerts) {
          statusText.innerHTML = '<i class="fas fa-robot text-primary"></i> Apenas alertas do sistema est√£o ativos';
          statusDisplay.className = 'alert alert-info d-flex align-items-center';
        } else if (!alertSettings.systemAlerts && alertSettings.customAlerts) {
          statusText.innerHTML = '<i class="fas fa-user-cog text-warning"></i> Apenas padr√µes customizados est√£o ativos';
          statusDisplay.className = 'alert alert-warning d-flex align-items-center';
        } else {
          statusText.innerHTML = '<i class="fas fa-exclamation-triangle text-danger"></i> Todos os alertas est√£o desabilitados';
          statusDisplay.className = 'alert alert-danger d-flex align-items-center';
        }

        // Atualizar badges visuais
        updateAlertBadges();
      }

      // Atualizar badges visuais dos tipos de alerta
      function updateAlertBadges() {
        const systemLabel = document.querySelector('label[for="enableSystemAlerts"]');
        const customLabel = document.querySelector('label[for="enableCustomAlerts"]');
        
        if (alertSettings.systemAlerts) {
          systemLabel.classList.remove('text-muted');
          systemLabel.classList.add('text-primary');
        } else {
          systemLabel.classList.remove('text-primary');
          systemLabel.classList.add('text-muted');
        }
        
        if (alertSettings.customAlerts) {
          customLabel.classList.remove('text-muted');
          customLabel.classList.add('text-success');
        } else {
          customLabel.classList.remove('text-success');
          customLabel.classList.add('text-muted');
        }
      }

      // Salvar configura√ß√µes no backend
      async function saveAlertSettingsToBackend() {
        try {
          console.log('Salvando configura√ß√µes no servidor:', alertSettings);
          
          const response = await fetch('/api/alert-settings', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(alertSettings)
          });
          
          console.log('Resposta do servidor:', response.status);
          
          if (response.ok) {
            const data = await response.json();
            console.log('Configura√ß√µes salvas no servidor:', data);
            if (data.success) {
              console.log('‚úÖ Configura√ß√µes sincronizadas com sucesso');
            }
          } else {
            console.warn('‚ùå Falha ao salvar no servidor:', response.status);
          }
        } catch (error) {
          console.error('‚ùå Erro ao salvar configura√ß√µes:', error);
        }
      }

      // Mostrar notifica√ß√£o das configura√ß√µes de alerta
      function showAlertSettingsNotification() {
        const notification = document.createElement('div');
        notification.className = 'alert alert-success alert-dismissible fade show position-fixed';
        notification.style.cssText = 'top: 80px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = `
          <i class="fas fa-check-circle"></i> Configura√ß√µes de alerta atualizadas!
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.body.appendChild(notification);

        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 3000);
      }

      // Fun√ß√£o para verificar se um tipo de alerta est√° habilitado
      function isAlertTypeEnabled(type) {
        if (type === 'system') {
          return alertSettings.systemAlerts;
        } else if (type === 'custom') {
          return alertSettings.customAlerts;
        }
        return false;
      }

      // Fun√ß√£o para testar alertas
      function testAlerts() {
        const systemEnabled = alertSettings.systemAlerts;
        const customEnabled = alertSettings.customAlerts;
        
        let message = 'Teste de Alertas:\n\n';
        
        if (systemEnabled && customEnabled) {
          message += '‚úÖ Alertas do Sistema: ATIVO\n‚úÖ Padr√µes Customizados: ATIVO\n\nAmbos os tipos de alertas ser√£o exibidos.';
          showSuccess('Teste realizado! Ambos os tipos de alertas est√£o ativos.');
        } else if (systemEnabled && !customEnabled) {
          message += '‚úÖ Alertas do Sistema: ATIVO\n‚ùå Padr√µes Customizados: INATIVO\n\nApenas alertas autom√°ticos do sistema ser√£o exibidos.';
          showSuccess('Teste realizado! Apenas alertas do sistema est√£o ativos.');
        } else if (!systemEnabled && customEnabled) {
          message += '‚ùå Alertas do Sistema: INATIVO\n‚úÖ Padr√µes Customizados: ATIVO\n\nApenas padr√µes customizados ser√£o exibidos.';
          showSuccess('Teste realizado! Apenas padr√µes customizados est√£o ativos.');
        } else {
          message += '‚ùå Alertas do Sistema: INATIVO\n‚ùå Padr√µes Customizados: INATIVO\n\n‚ö†Ô∏è ATEN√á√ÉO: Nenhum alerta ser√° exibido!';
          showError('Teste realizado! ATEN√á√ÉO: Todos os alertas est√£o desabilitados.');
        }
        
        // Mostrar um alerta de teste se pelo menos um tipo estiver ativo
        if (systemEnabled || customEnabled) {
          setTimeout(() => {
            showTestAlert(systemEnabled, customEnabled);
          }, 1500);
        }
      }

      // Mostrar alerta de teste
      function showTestAlert(systemEnabled, customEnabled) {
        const testAlert = document.createElement('div');
        testAlert.className = 'alert alert-info alert-dismissible fade show position-fixed';
        testAlert.style.cssText = 'top: 140px; right: 20px; z-index: 9999; min-width: 350px; max-width: 400px;';
        
        let alertType = '';
        let icon = '';
        
        if (systemEnabled && customEnabled) {
          alertType = 'SISTEMA & CUSTOMIZADO';
          icon = 'ü§ñ‚öôÔ∏è';
        } else if (systemEnabled) {
          alertType = 'SISTEMA';
          icon = 'ü§ñ';
        } else if (customEnabled) {
          alertType = 'CUSTOMIZADO';
          icon = '‚öôÔ∏è';
        }
        
        testAlert.innerHTML = `
          <div class="d-flex align-items-center">
            <div style="font-size: 24px; margin-right: 10px;">${icon}</div>
            <div>
              <strong>ALERTA DE TESTE - ${alertType}</strong><br>
              <small>Este √© um exemplo de como os alertas aparecer√£o durante o jogo.</small>
            </div>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(testAlert);

        setTimeout(() => {
          if (testAlert.parentNode) {
            testAlert.parentNode.removeChild(testAlert);
          }
        }, 8000);
      }

      // Fun√ß√£o de debug para verificar configura√ß√µes
      function debugAlertSettings() {
        console.log('=== DEBUG CONFIGURA√á√ïES DE ALERTA ===');
        
        // Verificar estado atual
        console.log('Estado atual:', alertSettings);
        
        // Verificar localStorage
        const localData = localStorage.getItem('alertSettings');
        console.log('localStorage:', localData);
        if (localData) {
          try {
            const parsed = JSON.parse(localData);
            console.log('localStorage parseado:', parsed);
          } catch (e) {
            console.error('Erro ao parsear localStorage:', e);
          }
        }
        
        // Verificar checkboxes
        const systemCheck = document.getElementById('enableSystemAlerts');
        const customCheck = document.getElementById('enableCustomAlerts');
        console.log('Checkbox Sistema:', systemCheck.checked);
        console.log('Checkbox Custom:', customCheck.checked);
        
        // Teste de salvamento
        console.log('Testando salvamento...');
        const testSave = {
          systemAlerts: systemCheck.checked,
          customAlerts: customCheck.checked,
          timestamp: new Date().toISOString()
        };
        
        fetch('/api/alert-settings', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(testSave)
        }).then(response => {
          console.log('Resposta do servidor:', response.status);
          return response.json();
        }).then(data => {
          console.log('Dados retornados:', data);
        }).catch(error => {
          console.error('Erro no teste:', error);
        });
        
        // Mostrar no console do navegador
        alert('Debug info enviado para o console (F12)');
      }

      async function loadPatterns() {
        console.log("loadPatterns() chamada");
        showLoading(true);
        try {
          const response = await fetch("/api/custom-patterns");
          console.log("Response status:", response.status);
          const data = await response.json();
          console.log("Data received:", data);

          if (data.success) {
            patterns = data.patterns;
            console.log("Patterns loaded:", patterns.length);
            renderPatterns();
            updateStats();
          } else {
            console.error("API error:", data.error);
            showError("Erro ao carregar padr√µes: " + data.error);
          }
        } catch (error) {
          console.error("Fetch error:", error);
          showError("Erro ao carregar padr√µes: " + error.message);
        } finally {
          showLoading(false);
        }
      }

      function renderPatterns() {
        const container = document.getElementById("patternsList");
        const emptyState = document.getElementById("emptyState");

        if (patterns.length === 0) {
          container.innerHTML = "";
          emptyState.style.display = "block";
          return;
        }

        emptyState.style.display = "none";

        container.innerHTML = patterns
          .map(
            (pattern) => `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card pattern-card ${
                      pattern.enabled ? "enabled" : "disabled"
                    }">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="card-title mb-0">${pattern.name}</h6>
                                <div class="action-buttons d-flex">
                                    <button class="btn btn-sm btn-outline-primary" onclick="editPattern('${
                                      pattern.pattern_id
                                    }')" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" onclick="viewStats('${
                                      pattern.pattern_id
                                    }')" title="Estat√≠sticas">
                                        <i class="fas fa-chart-bar"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deletePattern('${
                                      pattern.pattern_id
                                    }')" title="Excluir">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <p class="card-text text-muted small">${
                              pattern.description || "Sem descri√ß√£o"
                            }</p>
                            
                            <div class="mb-2">
                                <span class="badge trigger-badge bg-primary">${getTriggerTypeLabel(
                                  pattern.trigger_type
                                )}</span>
                                <span class="badge trigger-badge bg-secondary">${getActionTypeLabel(
                                  pattern.action
                                )}</span>
                            </div>
                            
                            <div class="row text-center">
                                <div class="col-4">
                                    <small class="text-muted">Sucessos</small>
                                    <div class="stats-badge badge bg-success">${
                                      pattern.success_count
                                    }</div>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted">Falhas</small>
                                    <div class="stats-badge badge bg-danger">${
                                      pattern.failure_count
                                    }</div>
                                </div>
                                <div class="col-4">
                                    <small class="text-muted">Taxa</small>
                                    <div class="stats-badge badge ${getSuccessRateClass(
                                      pattern.success_count,
                                      pattern.failure_count
                                    )}">
                                        ${getSuccessRate(
                                          pattern.success_count,
                                          pattern.failure_count
                                        )}%
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-2">
                                <small class="text-muted">
                                    <i class="fas fa-clock"></i> 
                                    ${
                                      pattern.last_triggered
                                        ? new Date(
                                            pattern.last_triggered
                                          ).toLocaleString()
                                        : "Nunca"
                                    }
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function updateStats() {
        const total = patterns.length;
        const active = patterns.filter((p) => p.enabled).length;
        const totalTriggers = patterns.reduce(
          (sum, p) => sum + p.success_count + p.failure_count,
          0
        );
        const totalSuccesses = patterns.reduce(
          (sum, p) => sum + p.success_count,
          0
        );
        const successRate =
          totalTriggers > 0
            ? Math.round((totalSuccesses / totalTriggers) * 100)
            : 0;

        document.getElementById("totalPatterns").textContent = total;
        document.getElementById("activePatterns").textContent = active;
        document.getElementById("totalTriggers").textContent = totalTriggers;
        document.getElementById("successRate").textContent = successRate + "%";
      }

      function getTriggerTypeLabel(type) {
        const labels = {
          number_followed_by_color: "N¬∫‚ÜíCor",
          color_sequence: "Seq.Cores",
          number_sequence: "Seq.N√∫meros",
          color_after_color: "Cor‚ÜíCor",
          number_after_number: "N¬∫‚ÜíN¬∫",
          specific_number_red: "N¬∫ Red",
          specific_number_black: "N¬∫ Black",
          specific_number_white: "N¬∫ White",
          red_after_black: "Red‚ÜíBlack",
          black_after_red: "Black‚ÜíRed",
          white_after_any: "White‚ÜíQualquer",
          number_delay_alert: "N¬∫+Delay",
        };
        return labels[type] || type;
      }

      function getActionTypeLabel(action) {
        const labels = {
          bet_color: "Apostar Cor",
          bet_number: "Apostar N¬∫",
          bet_sector: "Apostar Setor",
          skip_bet: "Pular",
          wait: "Aguardar",
        };
        return labels[action] || action;
      }

      function getSuccessRate(successes, failures) {
        const total = successes + failures;
        return total > 0 ? Math.round((successes / total) * 100) : 0;
      }

      function getSuccessRateClass(successes, failures) {
        const rate = getSuccessRate(successes, failures);
        if (rate >= 70) return "bg-success";
        if (rate >= 50) return "bg-warning";
        return "bg-danger";
      }

      function updateTriggerConfig() {
        const triggerType = document.getElementById("triggerType").value;
        const configArea = document.getElementById("triggerConfigArea");
        const helpElement = document.getElementById("triggerTypeHelp");

        // Update help text based on selection
        if (triggerType) {
          const selectedOption = document.querySelector(`#triggerType option[value="${triggerType}"]`);
          if (selectedOption) {
            const description = selectedOption.getAttribute('data-description') || '';
            const example = selectedOption.getAttribute('data-example') || '';
            helpElement.innerHTML = `
              <i class="fas fa-info-circle text-primary"></i> 
              <strong>${description}</strong><br>
              <small class="text-success">${example}</small>
            `;
          }
        } else {
          helpElement.innerHTML = `
            <i class="fas fa-arrow-up"></i> Selecione um tipo para ver a explica√ß√£o e exemplo
          `;
        }

        if (!triggerType) {
          configArea.style.display = "none";
          updateConfigPreview();
          return;
        }

        configArea.style.display = "block";

        let configHTML = "";

        switch (triggerType) {
          case "number_followed_by_color":
            configHTML = `
                        <div class="alert alert-info">
                          <i class="fas fa-info-circle"></i> 
                          <strong>Configure:</strong> Escolha um n√∫mero e a cor que deve vir ap√≥s ele.
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">N√∫mero (0-14)</label>
                                <input type="number" class="form-control" id="triggerNumber" min="0" max="14" value="1">
                                <small class="text-muted">Qualquer n√∫mero da roleta</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Cor que deve seguir</label>
                                <select class="form-select" id="triggerColor">
                                    <option value="red">üî¥ Vermelho</option>
                                    <option value="black">‚ö´ Preto</option>
                                    <option value="white">‚ö™ Branco</option>
                                </select>
                                <small class="text-muted">Cor que deve aparecer ap√≥s o n√∫mero</small>
                            </div>
                        </div>
                    `;
            break;

          case "color_sequence":
            configHTML = `
                        <div class="alert alert-info">
                          <i class="fas fa-info-circle"></i> 
                          <strong>Configure:</strong> Defina uma sequ√™ncia de 2 cores que devem aparecer consecutivamente.
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label class="form-label">Sequ√™ncia de Cores</label>
                                <div class="d-flex gap-2 align-items-center">
                                    <select class="form-select" id="sequenceColor1">
                                        <option value="red">üî¥ Vermelho</option>
                                        <option value="black">‚ö´ Preto</option>
                                        <option value="white">‚ö™ Branco</option>
                                    </select>
                                    <i class="fas fa-arrow-right text-primary"></i>
                                    <select class="form-select" id="sequenceColor2">
                                        <option value="red">üî¥ Vermelho</option>
                                        <option value="black">‚ö´ Preto</option>
                                        <option value="white">‚ö™ Branco</option>
                                    </select>
                                </div>
                                <small class="text-muted">Ex: Vermelho seguido de Preto</small>
                            </div>
                        </div>
                    `;
            break;

          case "color_after_color":
            configHTML = `
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Primeira Cor</label>
                                <select class="form-select" id="firstColor">
                                    <option value="red">Vermelho</option>
                                    <option value="black">Preto</option>
                                    <option value="white">Branco</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Segunda Cor</label>
                                <select class="form-select" id="secondColor">
                                    <option value="red">Vermelho</option>
                                    <option value="black">Preto</option>
                                    <option value="white">Branco</option>
                                </select>
                            </div>
                        </div>
                    `;
            break;

          case "specific_number_red":
            configHTML = `
                        <div class="row">
                            <div class="col-md-12">
                                <label class="form-label">N√∫mero Red (1, 3, 5, 7, 9, 12, 14)</label>
                                <select class="form-select" id="redNumber">
                                    <option value="1">1 (Red)</option>
                                    <option value="3">3 (Red)</option>
                                    <option value="5">5 (Red)</option>
                                    <option value="7">7 (Red)</option>
                                    <option value="9">9 (Red)</option>
                                    <option value="12">12 (Red)</option>
                                    <option value="14">14 (Red)</option>
                                </select>
                            </div>
                        </div>
                    `;
            break;

          case "specific_number_black":
            configHTML = `
                        <div class="row">
                            <div class="col-md-12">
                                <label class="form-label">N√∫mero Black (2, 4, 6, 8, 10, 11, 13)</label>
                                <select class="form-select" id="blackNumber">
                                    <option value="2">2 (Black)</option>
                                    <option value="4">4 (Black)</option>
                                    <option value="6">6 (Black)</option>
                                    <option value="8">8 (Black)</option>
                                    <option value="10">10 (Black)</option>
                                    <option value="11">11 (Black)</option>
                                    <option value="13">13 (Black)</option>
                                </select>
                            </div>
                        </div>
                    `;
            break;

          case "specific_number_white":
            configHTML = `
                        <div class="row">
                            <div class="col-md-12">
                                <label class="form-label">N√∫mero White (0)</label>
                                <select class="form-select" id="whiteNumber">
                                    <option value="0">0 (White)</option>
                                </select>
                            </div>
                        </div>
                    `;
            break;

          case "red_after_black":
            configHTML = `
                        <div class="row">
                            <div class="col-md-12">
                                <label class="form-label">Red Ap√≥s Black</label>
                                <small class="form-text text-muted">Detecta quando red aparece ap√≥s black</small>
                            </div>
                        </div>
                    `;
            break;

          case "black_after_red":
            configHTML = `
                        <div class="row">
                            <div class="col-md-12">
                                <label class="form-label">Black Ap√≥s Red</label>
                                <small class="form-text text-muted">Detecta quando black aparece ap√≥s red</small>
                            </div>
                        </div>
                    `;
            break;

          case "white_after_any":
            configHTML = `
                        <div class="row">
                            <div class="col-md-12">
                                <label class="form-label">White Ap√≥s Qualquer Cor</label>
                                <small class="form-text text-muted">Detecta quando white (0) aparece ap√≥s qualquer cor</small>
                            </div>
                        </div>
                    `;
            break;
          case "number_delay_alert":
            configHTML = `
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">N√∫mero que Ativa</label>
                                <input type="number" class="form-control" id="triggerNumberDelay" min="0" max="14" value="5">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Delay (resultados)</label>
                                <input type="number" class="form-control" id="delayResults" min="1" max="20" value="5">
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-12">
                                <small class="form-text text-muted">
                                    <strong>Exemplo:</strong> Quando sair o n√∫mero 5, aguardar 5 resultados e ent√£o alertar
                                </small>
                            </div>
                        </div>
                    `;
            break;
        }

        configArea.innerHTML = configHTML;
        updateConfigPreview();
      }

      function updateActionConfig() {
        const actionType = document.getElementById("actionType").value;
        const configArea = document.getElementById("actionConfigArea");
        const helpElement = document.getElementById("actionTypeHelp");

        // Update help text based on selection
        if (actionType) {
          const selectedOption = document.querySelector(`#actionType option[value="${actionType}"]`);
          if (selectedOption) {
            const description = selectedOption.getAttribute('data-description') || '';
            const example = selectedOption.getAttribute('data-example') || '';
            helpElement.innerHTML = `
              <i class="fas fa-info-circle text-success"></i> 
              <strong>${description}</strong><br>
              <small class="text-primary">${example}</small>
            `;
          }
        } else {
          helpElement.innerHTML = `
            <i class="fas fa-arrow-up"></i> Selecione uma a√ß√£o para ver a explica√ß√£o e exemplo
          `;
        }

        let configHTML = "";

        switch (actionType) {
          case "bet_color":
            configHTML = `
                        <div class="alert alert-success">
                          <i class="fas fa-info-circle"></i> 
                          <strong>Apostar em Cor:</strong> Escolha a cor que ser√° recomendada quando o padr√£o for detectado.
                        </div>
                        <label class="form-label">Cor para apostar</label>
                        <select class="form-select" id="actionColor">
                            <option value="red">üî¥ Vermelho (14x retorno)</option>
                            <option value="black">‚ö´ Preto (2x retorno)</option>
                            <option value="white">‚ö™ Branco (14x retorno)</option>
                        </select>
                        <small class="text-muted">A cor que ser√° recomendada no alerta</small>
                    `;
            break;

          case "bet_number":
            configHTML = `
                        <div class="alert alert-success">
                          <i class="fas fa-info-circle"></i> 
                          <strong>Apostar em N√∫mero:</strong> Escolha o n√∫mero espec√≠fico que ser√° recomendado.
                        </div>
                        <label class="form-label">N√∫mero para apostar (0-14)</label>
                        <input type="number" class="form-control" id="actionNumber" min="0" max="14" value="1">
                        <small class="text-muted">N√∫mero espec√≠fico que ser√° recomendado (retorno: 14x)</small>
                    `;
            break;

          case "skip_bet":
            configHTML = `
                        <div class="alert alert-warning">
                          <i class="fas fa-pause-circle"></i> 
                          <strong>Pular Aposta:</strong> O sistema recomendar√° n√£o apostar nesta rodada.
                        </div>
                        <div class="text-center p-3 bg-light rounded">
                          <i class="fas fa-hand-paper fa-2x text-warning mb-2"></i>
                          <p class="mb-0"><strong>Nenhuma configura√ß√£o adicional necess√°ria</strong></p>
                          <small class="text-muted">O alerta ser√°: "Pule esta rodada - aguarde melhor oportunidade"</small>
                        </div>
                    `;
            break;

          case "wait":
            configHTML = `
                        <div class="alert alert-info">
                          <i class="fas fa-clock"></i> 
                          <strong>Aguardar:</strong> O sistema recomendar√° observar mais resultados antes de apostar.
                        </div>
                        <div class="text-center p-3 bg-light rounded">
                          <i class="fas fa-hourglass-half fa-2x text-info mb-2"></i>
                          <p class="mb-0"><strong>Nenhuma configura√ß√£o adicional necess√°ria</strong></p>
                          <small class="text-muted">O alerta ser√°: "Aguarde - padr√£o ainda se formando"</small>
                        </div>
                    `;
            break;

          default:
            configHTML = `
                        <div class="text-center p-3 bg-light rounded">
                          <i class="fas fa-arrow-up fa-2x text-muted mb-2"></i>
                          <p class="text-muted mb-0">Selecione um tipo de a√ß√£o acima</p>
                        </div>
                    `;
        }

        configArea.innerHTML = configHTML;
        updateConfigPreview();
      }

      function updateConfigPreview() {
        const triggerType = document.getElementById("triggerType").value;
        const actionType = document.getElementById("actionType").value;
        const preview = document.getElementById("configPreview");

        if (!triggerType || !actionType) {
          preview.textContent =
            "Selecione um tipo de gatilho e a√ß√£o para ver a pr√©-visualiza√ß√£o";
          return;
        }

        let triggerDesc = "";
        let actionDesc = "";

        // Trigger description
        switch (triggerType) {
          case "number_followed_by_color":
            const number =
              document.getElementById("triggerNumber")?.value || "1";
            const color =
              document.getElementById("triggerColor")?.value || "red";
            triggerDesc = `Quando o n√∫mero ${number} for seguido por ${color}`;
            break;
          case "color_sequence":
            const color1 =
              document.getElementById("sequenceColor1")?.value || "red";
            const color2 =
              document.getElementById("sequenceColor2")?.value || "black";
            triggerDesc = `Quando aparecer a sequ√™ncia ${color1} ‚Üí ${color2}`;
            break;
          case "color_after_color":
            const firstColor =
              document.getElementById("firstColor")?.value || "red";
            const secondColor =
              document.getElementById("secondColor")?.value || "black";
            triggerDesc = `Quando ${firstColor} for seguido por ${secondColor}`;
            break;
          case "specific_number_red":
            const redNumber =
              document.getElementById("redNumber")?.value || "1";
            triggerDesc = `Quando o n√∫mero ${redNumber} (red) aparecer`;
            break;
          case "specific_number_black":
            const blackNumber =
              document.getElementById("blackNumber")?.value || "2";
            triggerDesc = `Quando o n√∫mero ${blackNumber} (black) aparecer`;
            break;
          case "specific_number_white":
            triggerDesc = `Quando o n√∫mero 0 (white) aparecer`;
            break;
          case "red_after_black":
            triggerDesc = `Quando red aparecer ap√≥s black`;
            break;
          case "black_after_red":
            triggerDesc = `Quando black aparecer ap√≥s red`;
            break;
          case "white_after_any":
            triggerDesc = `Quando white (0) aparecer ap√≥s qualquer cor`;
            break;
          case "number_delay_alert":
            const triggerNumberDelay =
              document.getElementById("triggerNumberDelay")?.value || "5";
            const delayResults =
              document.getElementById("delayResults")?.value || "5";
            triggerDesc = `Quando sair o n√∫mero ${triggerNumberDelay}, aguardar ${delayResults} resultados e alertar`;
            break;
        }

        // Action description
        switch (actionType) {
          case "bet_color":
            const actionColor =
              document.getElementById("actionColor")?.value || "red";
            actionDesc = `Apostar na cor ${actionColor}`;
            break;
          case "bet_number":
            const actionNumber =
              document.getElementById("actionNumber")?.value || "1";
            actionDesc = `Apostar no n√∫mero ${actionNumber}`;
            break;
          case "skip_bet":
            actionDesc = "Pular esta rodada";
            break;
          case "wait":
            actionDesc = "Aguardar pr√≥xima oportunidade";
            break;
        }

        preview.innerHTML = `
                <strong>Gatilho:</strong> ${triggerDesc}<br>
                <strong>A√ß√£o:</strong> ${actionDesc}
            `;
      }

      function updateConfidenceValue() {
        const slider = document.getElementById("confidenceThreshold");
        const value = document.getElementById("confidenceValue");
        value.textContent = Math.round(slider.value * 100) + "%";
        updateConfigPreview();
      }

      async function savePattern() {
        const form = document.getElementById("patternForm");
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        const triggerType = document.getElementById("triggerType").value;
        const actionType = document.getElementById("actionType").value;

        if (!triggerType || !actionType) {
          showError("Selecione um tipo de gatilho e a√ß√£o");
          return;
        }

        // Build trigger config
        let triggerConfig = {};
        switch (triggerType) {
          case "number_followed_by_color":
            triggerConfig = {
              number: parseInt(document.getElementById("triggerNumber").value),
              color: document.getElementById("triggerColor").value,
              min_occurrences: parseInt(
                document.getElementById("minOccurrences").value
              ),
            };
            break;
          case "color_sequence":
            triggerConfig = {
              sequence: [
                document.getElementById("sequenceColor1").value,
                document.getElementById("sequenceColor2").value,
              ],
              min_length: 2,
            };
            break;
          case "color_after_color":
            triggerConfig = {
              first_color: document.getElementById("firstColor").value,
              second_color: document.getElementById("secondColor").value,
              min_occurrences: parseInt(
                document.getElementById("minOccurrences").value
              ),
            };
            break;
          case "specific_number_red":
            triggerConfig = {
              number: parseInt(document.getElementById("redNumber").value),
              color: "red",
              min_occurrences: parseInt(
                document.getElementById("minOccurrences").value
              ),
            };
            break;
          case "specific_number_black":
            triggerConfig = {
              number: parseInt(document.getElementById("blackNumber").value),
              color: "black",
              min_occurrences: parseInt(
                document.getElementById("minOccurrences").value
              ),
            };
            break;
          case "specific_number_white":
            triggerConfig = {
              number: 0,
              color: "white",
              min_occurrences: parseInt(
                document.getElementById("minOccurrences").value
              ),
            };
            break;
          case "red_after_black":
            triggerConfig = {
              first_color: "black",
              second_color: "red",
              min_occurrences: parseInt(
                document.getElementById("minOccurrences").value
              ),
            };
            break;
          case "black_after_red":
            triggerConfig = {
              first_color: "red",
              second_color: "black",
              min_occurrences: parseInt(
                document.getElementById("minOccurrences").value
              ),
            };
            break;
          case "white_after_any":
            triggerConfig = {
              number: 0,
              color: "white",
              min_occurrences: parseInt(
                document.getElementById("minOccurrences").value
              ),
            };
            break;
          case "number_delay_alert":
            triggerConfig = {
              trigger_number: parseInt(
                document.getElementById("triggerNumberDelay").value
              ),
              delay_results: parseInt(
                document.getElementById("delayResults").value
              ),
              min_occurrences: parseInt(
                document.getElementById("minOccurrences").value
              ),
            };
            break;
        }

        // Build action config
        let actionConfig = {};
        switch (actionType) {
          case "bet_color":
            actionConfig = {
              color: document.getElementById("actionColor").value,
            };
            break;
          case "bet_number":
            actionConfig = {
              number: parseInt(document.getElementById("actionNumber").value),
            };
            break;
        }

        const patternData = {
          name: document.getElementById("patternName").value,
          description: document.getElementById("patternDescription").value,
          trigger_type: triggerType,
          trigger_config: triggerConfig,
          action: actionType,
          action_config: actionConfig,
          confidence_threshold: parseFloat(
            document.getElementById("confidenceThreshold").value
          ),
          cooldown_minutes: parseInt(
            document.getElementById("cooldownMinutes").value
          ),
          enabled: document.getElementById("patternEnabled").value === "true",
        };

        try {
          let response;
          if (editingPattern) {
            response = await fetch(`/api/custom-patterns/${editingPattern}`, {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(patternData),
            });
          } else {
            response = await fetch("/api/custom-patterns", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(patternData),
            });
          }

          const result = await response.json();

          if (result.success) {
            showSuccess(result.message);
            bootstrap.Modal.getInstance(
              document.getElementById("createPatternModal")
            ).hide();
            loadPatterns();
            resetForm();
          } else {
            showError("Erro ao salvar padr√£o: " + result.error);
          }
        } catch (error) {
          showError("Erro ao salvar padr√£o: " + error.message);
        }
      }

      function editPattern(patternId) {
        const pattern = patterns.find((p) => p.pattern_id === patternId);
        if (!pattern) return;

        editingPattern = patternId;
        document.getElementById("modalTitle").textContent = "Editar Padr√£o";

        // Fill form
        document.getElementById("patternName").value = pattern.name;
        document.getElementById("patternDescription").value =
          pattern.description;
        document.getElementById("triggerType").value = pattern.trigger_type;
        document.getElementById("actionType").value = pattern.action;
        document.getElementById("confidenceThreshold").value =
          pattern.confidence_threshold;
        document.getElementById("cooldownMinutes").value =
          pattern.cooldown_minutes;
        document.getElementById("patternEnabled").value =
          pattern.enabled.toString();

        updateTriggerConfig();
        updateActionConfig();
        updateConfidenceValue();

        // Fill trigger config
        if (pattern.trigger_config) {
          Object.keys(pattern.trigger_config).forEach((key) => {
            const element = document.getElementById(key.replace("_", ""));
            if (element) {
              element.value = pattern.trigger_config[key];
            }
          });
        }

        // Fill action config
        if (pattern.action_config) {
          Object.keys(pattern.action_config).forEach((key) => {
            const element = document.getElementById(
              "action" + key.charAt(0).toUpperCase() + key.slice(1)
            );
            if (element) {
              element.value = pattern.action_config[key];
            }
          });
        }

        updateConfigPreview();

        new bootstrap.Modal(
          document.getElementById("createPatternModal")
        ).show();
      }

      async function deletePattern(patternId) {
        if (!confirm("Tem certeza que deseja excluir este padr√£o?")) {
          return;
        }

        try {
          const response = await fetch(`/api/custom-patterns/${patternId}`, {
            method: "DELETE",
          });

          const result = await response.json();

          if (result.success) {
            showSuccess("Padr√£o exclu√≠do com sucesso");
            loadPatterns();
          } else {
            showError("Erro ao excluir padr√£o: " + result.error);
          }
        } catch (error) {
          showError("Erro ao excluir padr√£o: " + error.message);
        }
      }

      async function viewStats(patternId) {
        try {
          const response = await fetch(
            `/api/custom-patterns/${patternId}/stats`
          );
          const result = await response.json();

          if (result.success) {
            const stats = result.stats;
            document.getElementById("statsContent").innerHTML = `
                        <div class="row text-center">
                            <div class="col-4">
                                <h4 class="text-success">${
                                  stats.success_count
                                }</h4>
                                <small class="text-muted">Sucessos</small>
                            </div>
                            <div class="col-4">
                                <h4 class="text-danger">${
                                  stats.failure_count
                                }</h4>
                                <small class="text-muted">Falhas</small>
                            </div>
                            <div class="col-4">
                                <h4 class="text-primary">${
                                  stats.total_triggers
                                }</h4>
                                <small class="text-muted">Total</small>
                            </div>
                        </div>
                        <hr>
                        <div class="text-center">
                            <h3 class="text-info">${Math.round(
                              stats.success_rate * 100
                            )}%</h3>
                            <small class="text-muted">Taxa de Sucesso</small>
                        </div>
                        <hr>
                        <div class="text-center">
                            <small class="text-muted">
                                <strong>√öltimo Trigger:</strong><br>
                                ${
                                  stats.last_triggered
                                    ? new Date(
                                        stats.last_triggered
                                      ).toLocaleString()
                                    : "Nunca"
                                }
                            </small>
                        </div>
                    `;

            new bootstrap.Modal(document.getElementById("statsModal")).show();
          } else {
            showError("Erro ao carregar estat√≠sticas: " + result.error);
          }
        } catch (error) {
          showError("Erro ao carregar estat√≠sticas: " + error.message);
        }
      }

      async function exportPatterns() {
        try {
          const response = await fetch("/api/custom-patterns/export");
          const result = await response.json();

          if (result.success) {
            showSuccess("Padr√µes exportados com sucesso");
          } else {
            showError("Erro ao exportar padr√µes: " + result.error);
          }
        } catch (error) {
          showError("Erro ao exportar padr√µes: " + error.message);
        }
      }

      async function importPatterns(input) {
        const file = input.files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append("file", file);

        try {
          const response = await fetch("/api/custom-patterns/import", {
            method: "POST",
            body: formData,
          });

          const result = await response.json();

          if (result.success) {
            showSuccess("Padr√µes importados com sucesso");
            loadPatterns();
          } else {
            showError("Erro ao importar padr√µes: " + result.error);
          }
        } catch (error) {
          showError("Erro ao importar padr√µes: " + error.message);
        }

        input.value = "";
      }

      function resetForm() {
        editingPattern = null;
        document.getElementById("patternForm").reset();
        document.getElementById("modalTitle").textContent = "Criar Novo Padr√£o";
        document.getElementById("triggerConfigArea").style.display = "none";
        document.getElementById("actionConfigArea").innerHTML = "";
        document.getElementById("configPreview").textContent =
          "Selecione um tipo de gatilho para ver a pr√©-visualiza√ß√£o";
      }

      function showLoading(show) {
        document.getElementById("loading").style.display = show
          ? "block"
          : "none";
      }

      function showSuccess(message) {
        // Simple success notification
        const alert = document.createElement("div");
        alert.className =
          "alert alert-success alert-dismissible fade show position-fixed";
        alert.style.cssText =
          "top: 20px; right: 20px; z-index: 9999; min-width: 300px;";
        alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
        document.body.appendChild(alert);

        setTimeout(() => {
          if (alert.parentNode) {
            alert.parentNode.removeChild(alert);
          }
        }, 5000);
      }

      function showError(message) {
        // Simple error notification
        const alert = document.createElement("div");
        alert.className =
          "alert alert-danger alert-dismissible fade show position-fixed";
        alert.style.cssText =
          "top: 20px; right: 20px; z-index: 9999; min-width: 300px;";
        alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
        document.body.appendChild(alert);

        setTimeout(() => {
          if (alert.parentNode) {
            alert.parentNode.removeChild(alert);
          }
        }, 5000);
      }

      // Event listeners
      document
        .getElementById("triggerType")
        .addEventListener("change", updateTriggerConfig);
      document
        .getElementById("actionType")
        .addEventListener("change", updateActionConfig);
      document
        .getElementById("confidenceThreshold")
        .addEventListener("input", updateConfidenceValue);

      // Reset form when modal is hidden
      document
        .getElementById("createPatternModal")
        .addEventListener("hidden.bs.modal", resetForm);

      // Initialize tooltips
      document.addEventListener('DOMContentLoaded', function() {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl);
        });
      });

      // Add event listener for trigger type selection to show contextual help
      document.getElementById("triggerType").addEventListener("change", function() {
        const value = this.value;
        const helpElement = document.getElementById("triggerTypeHelp");
        
        if (value) {
          const option = this.querySelector(`option[value="${value}"]`);
          const description = option.getAttribute('data-description') || '';
          const example = option.getAttribute('data-example') || '';
          
          helpElement.innerHTML = `
            <div class="mt-2 p-2 bg-info bg-opacity-10 rounded">
              <i class="fas fa-info-circle text-primary"></i> 
              <strong>${description}</strong><br>
              <small class="text-success"><i class="fas fa-lightbulb"></i> ${example}</small>
            </div>
          `;
        }
        
        updateTriggerConfig();
      });

      // Add event listener for action type selection to show contextual help  
      document.getElementById("actionType").addEventListener("change", function() {
        const value = this.value;
        const helpElement = document.getElementById("actionTypeHelp");
        
        if (value) {
          const option = this.querySelector(`option[value="${value}"]`);
          const description = option.getAttribute('data-description') || '';
          const example = option.getAttribute('data-example') || '';
          
          helpElement.innerHTML = `
            <div class="mt-2 p-2 bg-success bg-opacity-10 rounded">
              <i class="fas fa-info-circle text-success"></i> 
              <strong>${description}</strong><br>
              <small class="text-primary"><i class="fas fa-lightbulb"></i> ${example}</small>
            </div>
          `;
        }
        
        updateActionConfig();
      });
    </script>
  </body>
</html>
